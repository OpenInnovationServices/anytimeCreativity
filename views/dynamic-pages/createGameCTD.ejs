<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

<style>
    /* .grid-square {
    width: 100px;
    height: 100px;
    display: inline-block;
    background-color: #fff;
    border: solid 1px rgb(0,0,0,0.2);
    padding: 10px;
    margin: 12px;
} */
    .drag-drop-container {
        padding: 30px;
    }

    .drop-container {
        min-height: 200px;
        width: 100%;
        background-color: aliceblue;
    }

    .image-div {
        max-width: 100px;
        max-height: 100px;
        text-align: center;
        font-size: 10px;
    }

    ul {
        align-items: center;
        list-style: none;
    }
</style>

<div class="container" style="padding: 2rem;">
    <h2>Dynamic App creation form</h2>
    <form>
        <div class="mb-3">
            <label for="companyName" class="form-label">Company Name</label>
            <input type="text" class="form-control" maxlength="20" id="companyName" name="companyName"
                placeholder="Enter your company name" required>
        </div>
        <!-- <select class="form-select form-select-lg mb-3" aria-label=".form-select-lg example">
            <option selected>Open this select menu</option>
            <option value="Connect The Dots">Connect The Dots</option>
           <option value="2">Two</option>
            <option value="3">Three</option>
        </select> -->


        <div class="row">
            <div class="col-md-6 col-sm-12 drag-drop-container">
                <div class="list">
                    <ul id="group1" class="row">
                        <% for(var i=0; i < data.length; i++) { %>
                            <%if (data[i].imageGroup==="001" ) { %>
                                <li class="col-md-2 p-1" data-image-name="<%= data[i].imageText %>"
                                    value="<%= data[i].imageUrl %>">
                                    <div class="image-div">
                                        <img src="<%= data[i].imageUrl %>" style="max-width: 40px;">
                                        <p class="image-text">
                                            <%= data[i].imageText %>
                                        </p>
                                    </div>
                                </li>
                                <% } %>
                                    <% } %>
                    </ul>
                </div>
            </div>
            <div class="col-md-6 col-sm-12 drag-drop-container">
                <div class="list">
                    <ul id="group2" class="drop-container">

                    </ul>
                </div>
            </div>
        </div>
        <div class="row bg-img">
            <div class="col-md-6 col-sm-12 drag-drop-container">
                <div class="list">
                    <ul id="group3" class="row">
                        <% for(var i=0; i < data.length; i++) { %>
                            <%if (data[i].imageGroup==="002" ) { %>
                                <li class="col-md-2 p-1" data-image-name="<%= data[i].imageText %>"
                                    value="<%= data[i].imageUrl %>">
                                    <div class="image-div">
                                        <img src="<%= data[i].imageUrl %>" style="max-width: 40px;">
                                        <p class="image-text">
                                            <%= data[i].imageText %>
                                        </p>
                                    </div>
                                </li>
                                <% } %>
                                    <% } %>
                    </ul>
                </div>
            </div>

            <div class="col-md-6 col-sm-12 drag-drop-container">
                <div class="list">
                    <ul id="group4" class="drop-container">

                    </ul>
                </div>
            </div>
        </div>

        <input type="submit" class="btn btn-warning btn-block col-6 " id="submitBtn" value="Submit">
    </form>

    <div class="container">
        <div class="links">
            <p id="firstP">
            <p></p>
        </div>
    </div>

</div>
<script src="/assets/js/Sortable.js"></script>
<script>
    new Sortable(group1, {
        group: 'shared1', // both lists have same group name
        animation: 150
    });
    new Sortable(group2, {
        group: 'shared1',
        animation: 150
    });


    new Sortable(group3, {
        group: 'shared2',
        animation: 150
    });

    new Sortable(group4, {
        group: 'shared2',
        animation: 150
    });

</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<script>
    $('#submitBtn').click(function (e) {
        e.preventDefault();
        var a = document.getElementById('group2').getElementsByTagName('li');
        var mixGroup = [];
        for (let i = 0; i < a.length; i++) {
            var object = {
                imageText: a[i].attributes[1].value,
                imageUrl: a[i].attributes[2].value
            }
            mixGroup.push(object)
        }

        var b = document.getElementById('group4').getElementsByTagName('li');
        var matchGroup = [];
        for (let i = 0; i < b.length; i++) {
            var object = {
                imageText: b[i].attributes[1].value,
                imageUrl: b[i].attributes[2].value
            }
            matchGroup.push(object);
        }
        var data = {
            companyName: document.getElementById('companyName').value,
            mixGroup: mixGroup,
            matchGroup: matchGroup
        }
        console.log(data);
        $.ajax({
            type: 'POST',
            url: '/dynamic/',
            data: data,
            success: function (data) {
                console.log(data)
                var newP = document.createElement("p");
                var textNode1 = document.createTextNode("Game Link: http://www.anytimecreativity.com/dynamic/ctd/" + data.insertedId);
                var textNode2 = document.createTextNode("Dashboard Link: http://www.anytimecreativity.com/dynamic/ctd/dashboard/" + data.insertedId);
                var textNode3 = document.createTextNode("Voting Link: http://www.anytimecreativity.com/dynamic/ctd/vote/" + data.insertedId);
                var textNode4 = document.createTextNode("Voting Dashboard: http://www.anytimecreativity.com/dynamic/ctd/vote/dashboard/" + data.insertedId);
                var documentFragment = document.createDocumentFragment();
                documentFragment.appendChild(newP);
                newP.appendChild(textNode1);
                newP.appendChild(document.createElement("br"));
                newP.appendChild(textNode2);
                newP.appendChild(document.createElement("br"));
                newP.appendChild(textNode3);
                newP.appendChild(document.createElement("br"));
                newP.appendChild(textNode4);
                document.getElementById("firstP").appendChild(newP);
                $('#submitBtn').prop("disabled", true);
            },
            error: function (data) {
                $('#failedMessage').show();
                console.log('An error occurred.');
                console.log(data);
            },
        });
        

    });
</script>


<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
    integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
    integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
    crossorigin="anonymous"></script>